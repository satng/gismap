define(["./AttributeCompression-046b70bd","./Transforms-4ee811db","./Matrix2-c430e55a","./defaultValue-81eec7ed","./TerrainEncoding-7b2c3643","./IndexDatatype-bed3935d","./RuntimeError-8952249c","./ComponentDatatype-9e86ac8f","./OrientedBoundingBox-e31a0f8a","./createTaskProcessorWorker","./_commonjsHelpers-3aae1032-26891ab7","./combine-3c023bda","./WebGLConstants-508b9636","./EllipsoidTangentPlane-0152c019","./AxisAlignedBoundingBox-52bc7e5b","./IntersectionTests-4d132f79","./Plane-7e828ad8"],(function(e,t,i,n,s,r,h,o,u,d,p,l,a,f,c,g,m){"use strict";const x=function(e,t,i,s,r,o){if(!n.defined(e))throw new h.DeveloperError("threshold is required.");if(!n.defined(t))throw new h.DeveloperError("keepAbove is required.");if(!n.defined(i))throw new h.DeveloperError("u0 is required.");if(!n.defined(s))throw new h.DeveloperError("u1 is required.");if(!n.defined(r))throw new h.DeveloperError("u2 is required.");let u,d,p;n.defined(o)?o.length=0:o=[],t?(u=i<e,d=s<e,p=r<e):(u=i>e,d=s>e,p=r>e);const l=u+d+p;let a,f,c,g,m,x;return 1===l?u?(a=(e-i)/(s-i),f=(e-i)/(r-i),o.push(1),o.push(2),1!==f&&(o.push(-1),o.push(0),o.push(2),o.push(f)),1!==a&&(o.push(-1),o.push(0),o.push(1),o.push(a))):d?(c=(e-s)/(r-s),g=(e-s)/(i-s),o.push(2),o.push(0),1!==g&&(o.push(-1),o.push(1),o.push(0),o.push(g)),1!==c&&(o.push(-1),o.push(1),o.push(2),o.push(c))):p&&(m=(e-r)/(i-r),x=(e-r)/(s-r),o.push(0),o.push(1),1!==x&&(o.push(-1),o.push(2),o.push(1),o.push(x)),1!==m&&(o.push(-1),o.push(2),o.push(0),o.push(m))):2===l?u||i===e?d||s===e?p||r===e||(f=(e-i)/(r-i),c=(e-s)/(r-s),o.push(2),o.push(-1),o.push(0),o.push(2),o.push(f),o.push(-1),o.push(1),o.push(2),o.push(c)):(x=(e-r)/(s-r),a=(e-i)/(s-i),o.push(1),o.push(-1),o.push(2),o.push(1),o.push(x),o.push(-1),o.push(0),o.push(1),o.push(a)):(g=(e-s)/(i-s),m=(e-r)/(i-r),o.push(0),o.push(-1),o.push(1),o.push(0),o.push(g),o.push(-1),o.push(2),o.push(0),o.push(m)):3!==l&&(o.push(0),o.push(1),o.push(2)),o},w=32767,C=16383,B=[],y=[],b=[],v=new i.Cartographic;let I=new i.Cartesian3;const E=[],A=[],V=[],z=[],M=[],N=new i.Cartesian3,H=new t.BoundingSphere,R=new u.OrientedBoundingBox,D=new i.Cartesian2,T=new i.Cartesian3;function O(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}O.prototype.clone=function(e){return n.defined(e)||(e=new O),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},O.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},O.prototype.initializeFromClipResult=function(e,t,i){let n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},O.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},O.prototype.isIndexed=function(){return n.defined(this.index)},O.prototype.getH=function(){return n.defined(this.index)?this.heightBuffer[this.index]:o.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},O.prototype.getU=function(){return n.defined(this.index)?this.uBuffer[this.index]:o.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},O.prototype.getV=function(){return n.defined(this.index)?this.vBuffer[this.index]:o.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};let U=new i.Cartesian2,F=-1;const P=[new i.Cartesian3,new i.Cartesian3],S=[new i.Cartesian3,new i.Cartesian3];function k(t,n){++F;let s=P[F],r=S[F];return s=e.AttributeCompression.octDecode(t.first.getNormalX(),t.first.getNormalY(),s),r=e.AttributeCompression.octDecode(t.second.getNormalX(),t.second.getNormalY(),r),I=i.Cartesian3.lerp(s,r,t.ratio,I),i.Cartesian3.normalize(I,I),e.AttributeCompression.octEncode(I,n),--F,n}O.prototype.getNormalX=function(){return n.defined(this.index)?this.normalBuffer[2*this.index]:(U=k(this,U),U.x)},O.prototype.getNormalY=function(){return n.defined(this.index)?this.normalBuffer[2*this.index+1]:(U=k(this,U),U.y)};const q=[];function W(e,t,i,s,r,h,o,u,d){if(0===o.length)return;let p=0,l=0;for(;l<o.length;)l=q[p++].initializeFromClipResult(o,l,u);for(let r=0;r<p;++r){const o=q[r];if(o.isIndexed())o.newIndex=h[o.index],o.uBuffer=e,o.vBuffer=t,o.heightBuffer=i,d&&(o.normalBuffer=s);else{const r=o.getKey();if(n.defined(h[r]))o.newIndex=h[r];else{const n=e.length;e.push(o.getU()),t.push(o.getV()),i.push(o.getH()),d&&(s.push(o.getNormalX()),s.push(o.getNormalY())),o.newIndex=n,h[r]=n}}}3===p?(r.push(q[0].newIndex),r.push(q[1].newIndex),r.push(q[2].newIndex)):4===p&&(r.push(q[0].newIndex),r.push(q[1].newIndex),r.push(q[2].newIndex),r.push(q[0].newIndex),r.push(q[2].newIndex),r.push(q[3].newIndex))}return q.push(new O),q.push(new O),q.push(new O),q.push(new O),d((function(e,n){const h=e.isEastChild,d=e.isNorthChild,p=h?C:0,l=h?w:C,a=d?C:0,f=d?w:C,c=E,g=A,m=V,U=M;c.length=0,g.length=0,m.length=0,U.length=0;const F=z;F.length=0;const P={},S=e.vertices;let k=e.indices;k=k.subarray(0,e.indexCountWithoutSkirts);const q=s.TerrainEncoding.clone(e.encoding),X=q.hasVertexNormals;let K=0;const Y=e.vertexCountWithoutSkirts,_=e.minimumHeight,L=e.maximumHeight,j=new Array(Y),G=new Array(Y),J=new Array(Y),Z=X?new Array(2*Y):void 0;let Q,$,ee,te,ie;for($=0,ee=0;$<Y;++$,ee+=2){const e=q.decodeTextureCoordinates(S,$,D);if(Q=q.decodeHeight(S,$),te=o.CesiumMath.clamp(e.x*w|0,0,w),ie=o.CesiumMath.clamp(e.y*w|0,0,w),J[$]=o.CesiumMath.clamp((Q-_)/(L-_)*w|0,0,w),te<20&&(te=0),ie<20&&(ie=0),w-te<20&&(te=w),w-ie<20&&(ie=w),j[$]=te,G[$]=ie,X){const e=q.getOctEncodedNormal(S,$,T);Z[ee]=e.x,Z[ee+1]=e.y}(h&&te>=C||!h&&te<=C)&&(d&&ie>=C||!d&&ie<=C)&&(P[$]=K,c.push(te),g.push(ie),m.push(J[$]),X&&(U.push(Z[ee]),U.push(Z[ee+1])),++K)}const ne=[];ne.push(new O),ne.push(new O),ne.push(new O);const se=[];let re,he;for(se.push(new O),se.push(new O),se.push(new O),$=0;$<k.length;$+=3){const e=k[$],t=k[$+1],i=k[$+2],n=j[e],s=j[t],r=j[i];ne[0].initializeIndexed(j,G,J,Z,e),ne[1].initializeIndexed(j,G,J,Z,t),ne[2].initializeIndexed(j,G,J,Z,i);const o=x(C,h,n,s,r,B);re=0,re>=o.length||(re=se[0].initializeFromClipResult(o,re,ne),re>=o.length||(re=se[1].initializeFromClipResult(o,re,ne),re>=o.length||(re=se[2].initializeFromClipResult(o,re,ne),he=x(C,d,se[0].getV(),se[1].getV(),se[2].getV(),y),W(c,g,m,U,F,P,he,se,X),re<o.length&&(se[2].clone(se[1]),se[2].initializeFromClipResult(o,re,ne),he=x(C,d,se[0].getV(),se[1].getV(),se[2].getV(),y),W(c,g,m,U,F,P,he,se,X)))))}const oe=h?-32767:0,ue=d?-32767:0,de=[],pe=[],le=[],ae=[];let fe=Number.MAX_VALUE,ce=-fe;const ge=b;ge.length=0;const me=i.Ellipsoid.clone(e.ellipsoid),xe=i.Rectangle.clone(e.childRectangle),we=xe.north,Ce=xe.south;let Be=xe.east;const ye=xe.west;for(Be<ye&&(Be+=o.CesiumMath.TWO_PI),$=0;$<c.length;++$)te=Math.round(c[$]),te<=p?(de.push($),te=0):te>=l?(le.push($),te=w):te=2*te+oe,c[$]=te,ie=Math.round(g[$]),ie<=a?(pe.push($),ie=0):ie>=f?(ae.push($),ie=w):ie=2*ie+ue,g[$]=ie,Q=o.CesiumMath.lerp(_,L,m[$]/w),Q<fe&&(fe=Q),Q>ce&&(ce=Q),m[$]=Q,v.longitude=o.CesiumMath.lerp(ye,Be,te/w),v.latitude=o.CesiumMath.lerp(Ce,we,ie/w),v.height=Q,me.cartographicToCartesian(v,I),ge.push(I.x),ge.push(I.y),ge.push(I.z);const be=t.BoundingSphere.fromVertices(ge,i.Cartesian3.ZERO,3,H),ve=u.OrientedBoundingBox.fromRectangle(xe,fe,ce,me,R),Ie=new s.EllipsoidalOccluder(me).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(be.center,ge,3,be.center,fe,N),Ee=ce-fe,Ae=new Uint16Array(c.length+g.length+m.length);for($=0;$<c.length;++$)Ae[$]=c[$];let Ve=c.length;for($=0;$<g.length;++$)Ae[Ve+$]=g[$];for(Ve+=g.length,$=0;$<m.length;++$)Ae[Ve+$]=w*(m[$]-fe)/Ee;const ze=r.IndexDatatype.createTypedArray(c.length,F);let Me;if(X){const e=new Uint8Array(U);n.push(Ae.buffer,ze.buffer,e.buffer),Me=e.buffer}else n.push(Ae.buffer,ze.buffer);return{vertices:Ae.buffer,encodedNormals:Me,indices:ze.buffer,minimumHeight:fe,maximumHeight:ce,westIndices:de,southIndices:pe,eastIndices:le,northIndices:ae,boundingSphere:be,orientedBoundingBox:ve,horizonOcclusionPoint:Ie}}))}));